package{	import com.brassmonkey.events.DeviceEvent;	import flash.display.MovieClip;	import flash.events.Event;	import flash.utils.setInterval;	import flash.external.ExternalInterface;	import com.adobe.serialization.json.JSONDecoder;		import com.greensock.*;	import flash.events.MouseEvent;		public class Connector extends MovieClip	{		//private var scheme:TestDoctorScheme=new TestDoctorScheme();				//private var bm:BMApplication;		private var interation:int = 0;		private var error:Boolean=false;		private var conn:Boolean=false;				public var listeningForState:Boolean = true;				protected var buttons:Vector.<MovieClip>;				public function buttonOver(e:MouseEvent)		{			TweenMax.to(e.currentTarget, 0.3, {colorTransform:{brightness:1.2}});		}				public function buttonOut(e:MouseEvent)		{			TweenMax.to(e.currentTarget, 0.3, {colorTransform:{brightness:1}});		}				public function Connector()		{			super();						stage.addEventListener(Event.RESIZE, onResize);						buttons = new Vector.<MovieClip>();						//Buttons			initBtn( helpBtn );			initBtn( download_ios );			initBtn( download_android );			initBtn( nodeviceBtn );						initBtn( needAppBtn );			initBtn( needWifiBtn );						addEventListener(Event.INIT, boot);			setStep( 1 );					}				public function initBtn( btn:MovieClip, doNotPush:Boolean = false ):void		{			btn.buttonMode = true;			btn.addEventListener( MouseEvent.MOUSE_OVER, buttonOver, false, 0, true );			btn.addEventListener( MouseEvent.MOUSE_OUT, buttonOut, false, 0, true );			if ( !doNotPush )				buttons.push( btn );		}				public function hideButtons():void		{			for ( var i:int = buttons.length - 1; i > -1; i-- )			{				buttons[i].visible = false;			}		}				public function setStep( step:uint ):void		{			if ( step < 1 || step > 3 )				return;						steps.step1.alpha = steps.step2.alpha = steps.step3.alpha = 0.3;			switch( step )			{				case 1:					steps.step1.alpha = 1;					break;				case 2:					steps.step2.alpha = 1;					break;				case 3:					steps.step3.alpha = 1;					break;			}		}				public function boot(event:Event):void		{			setStep( 1 );						hideButtons();						//_timer.visible = false;						loaderInfo.removeEventListener(Event.INIT, boot);			//	bm=new BMApplication(loaderInfo.parameters);			//	bm.client=this;						//	bm.initiate("Select Me",1);				//	bm.addEventListener(DeviceEvent.SLOT_DISPLAY_REQUEST, onSlot);			//	bm.addEventListener(DeviceEvent.DEVICE_AVAILABLE, onDevice);			//	bm.addEventListener(DeviceEvent.DEVICE_CONNECTED, onDevice);			//	bm.addEventListener(DeviceEvent.DEVICES_DISCOVERED, onDevice);				//	bm.addEventListener(DeviceEvent.DEVICE_DISCONNECTED , onDevice);			//	bm.start();			//if(ExternalInterface.available){				//ExternalInterface.addCallback("onTick",onTick);				//ExternalInterface.addCallback("setState",setState);				//ExternalInterface.addCallback("setSlot",setSlot);			//}						//Buttons					}		public function setState( val:String):void		{			if ( !listeningForState )				return;						trace(val);			var f:JSONDecoder=new JSONDecoder(val);			var messa:Object=f.getValue();			onDevice(messa);					}				public function onDevice(event:Object):void		{			trace(event.type);			phone.visible = false;			switch(event.type)			{				case DeviceEvent.DEVICES_DISCOVERED:					while(this._deviceList.numChildren>1)					{						_deviceList.removeChildAt(1);					}					var clients:Array=[];										for each (var device:Object in event.devices){										var d2:DeviceRendererClip = new DeviceRendererClip();					d2._deviceName.text=device.deviceName;					d2._deviceName.selectable = true;					_deviceList.addChild(d2);					clients.push(device.deviceName);				}										trace(clients);										if(!conn && !error && clients.length>0 && event.registry.devices.length==0)					{						hideButtons();						setStep( 2 );												nodeviceBtn.visible = true;						phone.visible = true;						_deviceList.visible = true;						_timer.visible = true;												quotes.visible = false;												nodeviceBtn.visible = true;												_info.y = 202;												topimage.visible = false;												//this._info.text='Do you see you device listed in box below?\nIf so, go to your device and select the option in the list.' ;					}					else if(!conn &&!error && event.registry.devices.length==0)					{						hideButtons();						setStep( 1 );												_deviceList.visible = false;						//_timer.visible = false;												helpBtn.visible = true;						quotes.visible = true;												_info.y = 270;												download_ios.visible = true;						download_android.visible = true;												topimage.visible = true;												//this._info.text='Download and start up the Brass Monkey application now. Make sure you device is on the same WiFi connection as your computer or smart tv.' ;					}					else					{											}					arrangeList();					//this.idDevices.dataProvider=new ArrayCollection(clients);					break;								case DeviceEvent.DEVICE_AVAILABLE:					if(event.registry.devices.length==0)					{						//this._info.text='Okay, Lets see if we can connect your device over your local lan.' ;						conn=true;						//event.device.addEventListener(DeviceEvent.CAN_NOT_CONNECT, onDevice);						//bm.session.connectDevice(event.device);											}					break;								case DeviceEvent.CAN_NOT_CONNECT:					trace("cant connect");					conn=false;					error=true;					//this._info.text='No! Unfortunalty, your LAN configuration is preventing the connection. Reconfigure your LAN and please try again.' ;					break;									case DeviceEvent.DEVICE_CONNECTED:					//event.device.removeEventListener(DeviceEvent.CAN_NOT_CONNECT, onDevice);					setStep( 3 );					conn=false;					//this._info.text='Success! You are now ready to play games!' ;										break;				case DeviceEvent.DEVICE_DISCONNECTED :					setStep( 2 );							break;			}		}				public function onResize(event:Event):void		{			if ( phone && phone.instructions && phone.instructions.channeltip ) {				phone.instructions.channeltip.x = stage.stageWidth - phone.instructions.channeltip.width;		}		private function arrangeList():void		{			var i:int = 1;						var h:int = this._deviceList.numChildren;						for(i=1;i<h;i++){				this._deviceList.getChildAt(i).x=12;				this._deviceList.getChildAt(i).y=(34 * (i-1))+2;			}					}				public function onTick(val:int):void		{			_timer.text="Re-checking for smart-devices in.. "+val;			_timer.selectable = true;		}			}}