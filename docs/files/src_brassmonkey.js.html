<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;brassmonkey.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/BrassMonkey.html">BrassMonkey</a></li>
            
                <li><a href="..&#x2F;classes/Device.html">Device</a></li>
            
                <li><a href="..&#x2F;classes/DeviceAvailableEvent.html">DeviceAvailableEvent</a></li>
            
                <li><a href="..&#x2F;classes/DeviceConnectedEvent.html">DeviceConnectedEvent</a></li>
            
                <li><a href="..&#x2F;classes/DeviceDisconnectedEvent.html">DeviceDisconnectedEvent</a></li>
            
                <li><a href="..&#x2F;classes/ShowSlotColorEvent.html">ShowSlotColorEvent</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;brassmonkey.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function(){

&#x2F;**
Initialize Brass Monkey

@method init
@param {Object} options Options 
  for initializing Brass Monkey.
  @param {String} options.name The name of your game. This is what 
    is displayed on the phone when you pick what to connect to.
    
    Example: &quot;Monkey Golf&quot;
  @param {String} options.appID The unique identifier of your Game&#x2F;App. You
    must generate this through the developer admin interface.
    
  @param {Number} [options.maxPlayers=1]
    The number of players that can play your game.
    
  @param {URL} [options.swfURL]
    The location of the SWF file that implements 
    the SDK when there a browser doesn&#x27;t support Websockets. 
    
    If not provided the matching version on the Brass Monkey CDN is used.
**&#x2F;
bm.init = function(options){
  
  &#x2F;&#x2F; Store options for convenient access later
    &#x2F;&#x2F; TODO: Add defaults to these options for those not provided.
  bm.options = options;  
    &#x2F;&#x2F; If no images&#x2F;layout were provided we default them to being empty arrays.
    &#x2F;&#x2F; This could be the case for when certain hosts like the website only
    &#x2F;&#x2F; use the built in controllers (Keyboard Mode, Navigation Mode, and any future
    &#x2F;&#x2F; ones) 
  bm.options.design.images =  options.design.images?options.design.images:[];
  bm.options.design.layout =  options.design.layout?options.design.layout:[];
  
  &#x2F;&#x2F; Choose the proper communication runtime based on the environment.
  &#x2F;&#x2F; For now it&#x27;s basically WebSockets in Mobile Safari otherwise Flash
  &#x2F;&#x2F; everywhere else.
  if(bm.detectIOS()){
    bm.runtime = new bm.WebSocketsImpl();
  } else {
    bm.runtime = new bm.FlashImpl();
  }
}

&#x2F;&#x2F;--------------------------------------
&#x2F;&#x2F; Public API
&#x2F;&#x2F;-------------------------------------- 
var events = [
  &#x27;DeviceConnected&#x27;,
  &#x27;DeviceDisconnected&#x27;,
  &#x27;NavigationString&#x27;,
  &#x27;KeyString&#x27;,
  &#x27;Invocation&#x27;,
  &#x27;ShakeReceived&#x27;,
  &#x27;AccelReceived&#x27;,
  &#x27;Log&#x27;,
  &quot;ShowSlot&quot;
];

for(var i = 0; i&lt;events.length;i++){
  var hookable = createHookableFunction(events[i],events[i]!=&#x27;AccelReceived&#x27;&amp;&amp;events[i]!=&#x27;Log&#x27;);
  bm[&#x27;on&#x27;+events[i]] = hookable.register;
  bm[&#x27;on&#x27;+events[i]+&quot;Internal&quot;] = hookable.internal;
}

&#x2F;&#x2F; onDeviceAvailable
var onDeviceAvailable = createHookableFunction(events[i],events[i]!=&#x27;AccelReceived&#x27;&amp;&amp;events[i]!=&#x27;Log&#x27;);
bm.onDeviceAvailable = function(cb){
  onDeviceAvailable.register(cb);
}

bm.onDeviceAvailableInternal = function(device){
  device.controlMode=bm.MODE_NAVIGATION;
  onDeviceAvailable.internal(device);
  return device;
}

var touchCBs = [];
bm.onTouchesReceived = function(cb){
  touchCBs.push(cb);
}
bm.onTouchesReceivedInternal = function(touchEvent){
  for(var i =0; i&lt;touchEvent.touches.length;i++){
    var touch = touchEvent.touches[i];
    for(var cb = 0; cb&lt;touchCBs.length; cb++){
      touchCBs[cb](touch,touchEvent.deviceId);
    }  
  }
}

&#x2F;&#x2F; For Convenience we create a stable list of 
&#x2F;&#x2F; [0,n] index values each associated with a
&#x2F;&#x2F; controller via It&#x27;s deviceId. This is useful
&#x2F;&#x2F; things like making each controller have it&#x27;s
&#x2F;&#x2F; own cursor that uses the index to assign
&#x2F;&#x2F; colors as controllers connect
var controllerSlotIndexes = [];

bm.getControllerSlot = function(deviceId){
  for(var i = 0; i&lt;controllerSlotIndexes.length;i++){
    if(controllerSlotIndexes[i]==deviceId){
      return i;
    }
  }
};

bm.getControllerCount = function(){
  var count = 0;
  for(var i = 0; i&lt;controllerSlotIndexes.length;i++){
    if(controllerSlotIndexes[i]!==undefined){
      count++;
    }
  }
  return count;
};

bm.getControllers = function (){
  var controllers = [];
  for(var i = 0; i&lt;controllerSlotIndexes.length;i++){
    if(controllerSlotIndexes[i]!==undefined){
      controllers.push(controllerSlotIndexes[i]);
    }
  }
  return controllers;
};

bm.getDeviceName = function(deviceId){
  return perDeviceAttributes[deviceId].deviceName;
}




&#x2F;&#x2F;--------------------------------------
&#x2F;&#x2F; Implementation
&#x2F;&#x2F;-------------------------------------- 

bm.onDeviceConnected(function(device){
  perDeviceAttributes[device.deviceId] = {
    hackForOldNavEventsEnabled: false,
    deviceName:device.deviceName
  };
  
  &#x2F;&#x2F; Assign the lowest indexed slot value
  for(var i = 0; i&lt;controllerSlotIndexes.length;i++){
    if(controllerSlotIndexes[i]===undefined){
      controllerSlotIndexes[i] = device.deviceId;
      return;
    }
  }
  
  &#x2F;&#x2F; Create a slot if all slots are filled.
  &#x2F;&#x2F; This grows the list of slots as more controllers
  &#x2F;&#x2F; connect.
  controllerSlotIndexes.push(device.deviceId);
});

bm.onDeviceDisconnected(function(device){
  delete perDeviceAttributes[device.deviceId];
  
  &#x2F;&#x2F; Remove device from slots
  for(var i = 0; i&lt;controllerSlotIndexes.length;i++){
    if(controllerSlotIndexes[i]==device.deviceId){
      controllerSlotIndexes[i] = undefined;
      break;
    }
  }
});

function createHookableFunction(publicName,loggable){
  &#x2F;&#x2F; Generate function for registering listeners
  var CBs = [];
  function registerListener(cb){
    CBs.push(cb);
  };
   
  &#x2F;&#x2F; Generate function that flash bridge should call
  function internal(){
    if(loggable){
      bm.log(&#x27;on&#x27;+publicName+&#x27;(&#x27;);;
      for(var i=0;i&lt;arguments.length;i++){
        bm.log(&#x27;    &#x27;+JSON.stringify(arguments[i]));
      }
      bm.log(&#x27;)&#x27;);
    }
  
    &#x2F;&#x2F; Super Hack for supporting first version of App&#x27;s Old Navigation Events
    if(publicName==&quot;NavigationString&quot;){
      if( (arguments[1]==&quot;left&quot;||
          arguments[1]==&quot;right&quot;||
          arguments[1]==&quot;up&quot;||
          arguments[1]==&quot;down&quot;||
          arguments[1]==&quot;back&quot;||
          arguments[1]==&quot;activate&quot;)&amp;&amp;
          !perDeviceAttributes[arguments[0]].hackForOldNavEventsEnabled ){
        var original = arguments[1];
        
        
        &#x2F;&#x2F;alert(arguments[1]);
        for(var i = 0; i&lt;CBs.length;i++){
          arguments[1]=original+&quot;Down&quot;;
          try{
            CBs[i].apply(bm, arguments);
          } catch(e){
            console.log(&#x27;UnhandledException (&#x27;+e+&#x27;) in &#x27;+bmHooks[j]+&#x27; Callback&#x27;);
          }
          arguments[1]=original+&quot;Clicked&quot;;
          try{
            CBs[i].apply(bm, arguments);
          } catch(e){
            console.log(&#x27;UnhandledException (&#x27;+e+&#x27;) in &#x27;+bmHooks[j]+&#x27; Callback&#x27;);
          }
        }
        arguments[1]=original+&quot;Up&quot;;
      } else {
        perDeviceAttributes[arguments[0]].hackForOldNavEventsEnabled = true;
      }
    }
  
    for(var i = 0; i&lt;CBs.length;i++){
      try{
        CBs[i].apply(bm, arguments);
      } catch(e){
        console.log(&#x27;UnhandledException (&#x27;+e+&#x27;) in &#x27;+bmHooks[j]+&#x27; Callback&#x27;);
      }
    }
  }  
  
  return {register:registerListener,internal:internal};
}

&#x2F;&#x2F; Returns the version of Internet Explorer or a -1
&#x2F;&#x2F; (indicating the use of another browser).
function getInternetExplorerVersion(){
  var rv = -1; &#x2F;&#x2F; Return value assumes failure.
  if (navigator.appName == &#x27;Microsoft Internet Explorer&#x27;)
  {
    var ua = navigator.userAgent;
    var re  = new RegExp(&quot;MSIE ([0-9]{1,}[\.0-9]{0,})&quot;);
    if (re.exec(ua) != null)
      rv = parseFloat( RegExp.$1 );
  }
  return rv;
}

&#x2F;*---------------------------------------------------------------------------------------
Enumerate Events here. I (Francois) tried to put these in events.js but couldn&#x27;t get 
them to properly associate with the BrassMonkey Class.
---------------------------------------------------------------------------------------*&#x2F;

&#x2F;**
Event called when a mobile device successfully established a connection.

@event deviceavailable
@param {DeviceAvailableEvent} event
**&#x2F;

&#x2F;**
Event called when a mobile device successfully established a connection.

@event deviceconnected
@param {DeviceConnectedEvent} event
**&#x2F;

&#x2F;**
Event called when a mobile device is disconnected.

@event devicedisconnected
@param {DeviceDisconnectedEvent} event
**&#x2F;

&#x2F;**
Event called when a mobile device is disconnected.

@event devicedisconnected
@param {DeviceDisconnectedEvent} event
**&#x2F;



})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
