<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebSocket Test</title>

  <script language="javascript" type="text/javascript" src="core.js" ></script>
  <script language="javascript" type="text/javascript" src="base64.js" ></script>
  <script language="javascript" type="text/javascript" src="resources.js" ></script>
  <script language="javascript" type="text/javascript" src="device.js" ></script>
  
  <script language="javascript" type="text/javascript" src="detect.js" ></script>
  
  <script language="javascript" type="text/javascript" src="flash/swfobject.js" ></script>
  <script language="javascript" type="text/javascript" src="flash/flash.js" ></script>
  
  <script language="javascript" type="text/javascript" src="websockets/websockets.js" ></script>

  <script language="javascript" type="text/javascript">
    bm.start({
      
      name: "Websockets Test",
      maxPlayers: 1,
      
      //appId:"62e822bc0e6b9f22fc158763591845be",
      swfURL: "swf/bin/brassmonkey.swf",
      
      design: {
        orientation: "portrait",
        touchEnabled: true,
        accelerometerEnabled: false,
        images:[
          '../examples/shared/background.png',
          '../examples/buttons/button-up.png',
          '../examples/buttons/button-down.png'
        ],
        layout:[{
          type:   "image",
          image:  0,
          x:      0,
          y:      0,
          width:  320,
          height: 480
        }, {
          type:       "button",
          handler:    "push",
          imageUp:    1,
          imageDown:  2,
          x:          (320-160)/2-3,
          y:          (480-160)/2,
          width:      160,
          height:     160
        }]
      }
    });
    

    // Should fail as 10 isn't a function.
    bm.on('buttondown', function(e){
      if(e.id="push"){
        var button = document.getElementById('button');
        button.style.background = "red";
      }
    });
    bm.on('buttonup', function(e){
      if(e.id="push"){
        var button = document.getElementById('button');
        button.style.background = "#ffafaf";
      }
    });

    bm.on('deviceconnected', function (e){
      bm.log("device connected %o", e);
      
     e.device.enableTouch(true);
     e.device.setTouchInterval(1/60);

     bm.log("device gyro: %b, orientation: %b", e.device.hasCapability("gyroscope"), e.device.hasCapability("orientation"));
    });
    
    bm.on('acceleration', function (e){
      //bm.log(e);
    });
    
    var touches = {};
    bm.on('touchstart', function (e){
      var color = '#'+Math.floor(Math.random()*16777215).toString(16);
    
      drawContext.fillStyle=color;
      drawContext.fillRect(e.x-1,e.y-1,3,3);
    
      // Store the last position of a touch
      touches[e.id]={
        x:e.x,
        y:e.y,
        color: color
      };
    });

    bm.on('touchmove', function (e){
      drawContext.strokeStyle=touches[e.id].color;
      drawContext.beginPath();
      drawContext.moveTo(touches[e.id].x,touches[e.id].y);
      drawContext.lineTo(e.x,e.y);
      drawContext.stroke();
      
      // Update the last position
      touches[e.id]={x:e.x,y:e.y};
    });
    bm.on('touchend', function (e){
      // Delete the touch from our list of tracked ones
      delete touches[e.id]
    });
    
    function onload(){
      // Initialize canvas to black.      
      drawContext = document.getElementById('canvas').getContext('2d');
      drawContext.fillStyle="black";
      drawContext.fillRect(0,0,320,480);
      
      drawContext.lineWidth = 3;
      drawContext.lineCap = ctx.lineJoin = "round";
    }


    bm.on('navstring', function (e){
      bm.log("nav string %s", e.string);
    });

    
  </script>
</head>
<body style="margin:0px" onload="onload();">
  <div id="button" style="padding-top: 30px;width:64px;height:64px;background:#ffafaf;"></div>
  <canvas id="canvas" width="320px" height="480px"></canvas>

<br><br>
<ul>
<li><a href="javascript:void(0)" onClick="bm.allDevices().setMode('keyboard')"> keyboard </a></li>
<li><a href="javascript:void(0)" onClick="bm.allDevices().setMode('navigation')"> navigation </a></li>
<li><a href="javascript:void(0)" onClick="bm.allDevices().setMode('gamepad')"> gamepad </a></li>
<li><a href="javascript:void(0)" onClick="bm.allDevices().setMode('wait')"> wait </a></li>
</ul>

</body>
</html>