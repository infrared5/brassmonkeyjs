<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebSocket Test</title>

  <script language="javascript" type="text/javascript" src="../core.js" ></script>
  
  <script language="javascript" type="text/javascript" src="../base64.js" ></script>
  <script language="javascript" type="text/javascript" src="../resources.js" ></script>
  <script language="javascript" type="text/javascript" src="../device.js" ></script>
  
  <script language="javascript" type="text/javascript" src="websockets.js" ></script>

  <script language="javascript" type="text/javascript">
    function init(){
      output = document.getElementById("output");
    }
    
    function testWebSocket(){
      bm.stop();
      bm.start({
        
        name: "Websockets Test",
        maxPlayers: 1,
        
        //appId:"62e822bc0e6b9f22fc158763591845be",
        
        design: {
          orientation: "portrait",
          touchEnabled: false,
          accelerometerEnabled: false,
          images:[
            '../../examples/shared/background.png',
            '../../examples/buttons/button-up.png',
            '../../examples/buttons/button-down.png'
          ],
          layout:[{
            type:   "image",
            image:  0,
            x:      0,
            y:      0,
            width:  320,
            height: 480
          }, {
            type:       "button",
            handler:    "push",
            imageUp:    1,
            imageDown:  2,
            x:          (320-160)/2-3,
            y:          (480-160)/2,
            width:      160,
            height:     160
          }]
        }
      });
    }
  
    function onOpen(evt){
      output.innerHTML="";
      writeToScreen("CONNECTED");
      send('[17039360,17039360]')
      send('[0,0,1,0,0,2,3,"fake_device_id","fake_device_name",true,[9,[18,3,"fake_device_id","fake_device_name"],[1,"localhost",6666,7777]]]');
      send('[0,3,1,0,0,0,3,"fake_device_id","fake_device_name",true,[4,0,"setReliabilityForTouch","",2,[3,"i",2],[3,"i",2]]]');
    }
  
    function onClose(evt) {
      writeToScreen("DISCONNECTED");
    }
  
    function onMessage(evt) {
      writeToScreen('<span style="color: blue;">'+evt.data+'</span>');
      messageCount++;
      if(messageCount == 4) {
        send('[0,5,5,0,0,0,3,"fake_device_id","fake_device_name",true,[14,"testXML",0,186,186,"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPEJNQXBwbGljYXRpb25TY2hlbWUgdmVyc2lvbj0iMC4xIiBvcmllbnRhdGlvbj0icG9ydHJhaXQiIHRvdWNoRW5hYmxlZD0ieWVzIiBhY2NlbGVyb21ldGVyRW5hYmxlZD0ibm8iPgo8UmVzb3VyY2VzLz48TGF5b3V0Lz48L0JNQXBwbGljYXRpb25TY2hlbWU+"]]');
        send('[0,3,1,0,0,0,3,"fake_device_id","fake_device_name",true,[4,0,"enableAccelerometer","",2,[3,"i",1],[3,"f",0.01]]]');
      }
    }
  
    function onError(evt) {
      writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.type);
    }
    
    function send(text) {
      writeToScreen('<span style="color: green;">'+text+'</span> ');
      websocket.send(text);
    }
    
    function writeToScreen(message) {
      var pre = document.createElement("p");
      pre.style.wordWrap = "break-word";
      pre.innerHTML = message;
      output.appendChild(pre);
    }  
  </script>
</head>
<body onload="init();">
<h2>WebSocket Test</h2>
<input type="button" onclick="testWebSocket();" value="Test">
<div id="output"></div>
</body>
</html>